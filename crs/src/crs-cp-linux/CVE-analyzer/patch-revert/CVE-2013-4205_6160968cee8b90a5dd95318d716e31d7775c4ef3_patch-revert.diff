diff --git a/kernel/user_namespace.c b/kernel/user_namespace.c
index 6e50a44610ee..d8c30db06c5b 100644
--- a/kernel/user_namespace.c
+++ b/kernel/user_namespace.c
@@ -105,21 +105,16 @@ int create_user_ns(struct cred *new)
 int unshare_userns(unsigned long unshare_flags, struct cred **new_cred)
 {
 	struct cred *cred;
-	int err = -ENOMEM;
 
 	if (!(unshare_flags & CLONE_NEWUSER))
 		return 0;
 
 	cred = prepare_creds();
-	if (cred) {
-		err = create_user_ns(cred);
-		if (err)
-			put_cred(cred);
-		else
-			*new_cred = cred;
-	}
+	if (!cred)
+		return -ENOMEM;
 
-	return err;
+	*new_cred = cred;
+	return create_user_ns(cred);
 }
 
 void free_user_ns(struct user_namespace *ns)
