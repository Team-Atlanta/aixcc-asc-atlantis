diff --git a/fs/open.c b/fs/open.c
index 081d3d6df74b..17cb6b1dab75 100644
--- a/fs/open.c
+++ b/fs/open.c
@@ -840,12 +840,16 @@ EXPORT_SYMBOL(file_path);
 int vfs_open(const struct path *path, struct file *file,
 	     const struct cred *cred)
 {
-	struct inode *inode = vfs_select_inode(path->dentry, file->f_flags);
-
-	if (IS_ERR(inode))
-		return PTR_ERR(inode);
+	struct dentry *dentry = path->dentry;
+	struct inode *inode = dentry->d_inode;
 
 	file->f_path = *path;
+	if (dentry->d_flags & DCACHE_OP_SELECT_INODE) {
+		inode = dentry->d_op->d_select_inode(dentry, file->f_flags);
+		if (IS_ERR(inode))
+			return PTR_ERR(inode);
+	}
+
 	return do_dentry_open(file, inode, NULL, cred);
 }
 
diff --git a/include/linux/dcache.h b/include/linux/dcache.h
index 7e9422cb5989..4bb4de8d95ea 100644
--- a/include/linux/dcache.h
+++ b/include/linux/dcache.h
@@ -565,16 +565,4 @@ static inline struct dentry *d_real(struct dentry *dentry)
 		return dentry;
 }
 
-static inline struct inode *vfs_select_inode(struct dentry *dentry,
-					     unsigned open_flags)
-{
-	struct inode *inode = d_inode(dentry);
-
-	if (inode && unlikely(dentry->d_flags & DCACHE_OP_SELECT_INODE))
-		inode = dentry->d_op->d_select_inode(dentry, open_flags);
-
-	return inode;
-}
-
-
 #endif	/* __LINUX_DCACHE_H */
