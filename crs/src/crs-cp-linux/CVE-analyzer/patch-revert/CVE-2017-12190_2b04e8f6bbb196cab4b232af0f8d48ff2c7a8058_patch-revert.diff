diff --git a/block/bio.c b/block/bio.c
index 9e9606d26cc6..0d6439e89acb 100644
--- a/block/bio.c
+++ b/block/bio.c
@@ -1331,7 +1331,6 @@ struct bio *bio_map_user_iov(struct request_queue *q,
 	int ret, offset;
 	struct iov_iter i;
 	struct iovec iov;
-	struct bio_vec *bvec;
 
 	iov_for_each(iov, i, *iter) {
 		unsigned long uaddr = (unsigned long) iov.iov_base;
@@ -1376,12 +1375,7 @@ struct bio *bio_map_user_iov(struct request_queue *q,
 		ret = get_user_pages_fast(uaddr, local_nr_pages,
 				(iter->type & WRITE) != WRITE,
 				&pages[cur_page]);
-		if (unlikely(ret < local_nr_pages)) {
-			for (j = cur_page; j < page_limit; j++) {
-				if (!pages[j])
-					break;
-				put_page(pages[j]);
-			}
+		if (ret < local_nr_pages) {
 			ret = -EFAULT;
 			goto out_unmap;
 		}
@@ -1437,8 +1431,10 @@ struct bio *bio_map_user_iov(struct request_queue *q,
 	return bio;
 
  out_unmap:
-	bio_for_each_segment_all(bvec, bio, j) {
-		put_page(bvec->bv_page);
+	for (j = 0; j < nr_pages; j++) {
+		if (!pages[j])
+			break;
+		put_page(pages[j]);
 	}
  out:
 	kfree(pages);
