diff --git a/net/socket.c b/net/socket.c
index 5f77a8e93830..c5ddc52cf2b2 100644
--- a/net/socket.c
+++ b/net/socket.c
@@ -2244,31 +2244,31 @@ int __sys_recvmmsg(int fd, struct mmsghdr __user *mmsg, unsigned int vlen,
 		cond_resched();
 	}
 
-	if (err == 0)
-		goto out_put;
+out_put:
+	fput_light(sock->file, fput_needed);
 
-	if (datagrams == 0) {
-		datagrams = err;
-		goto out_put;
-	}
+	if (err == 0)
+		return datagrams;
 
-	/*
-	 * We may return less entries than requested (vlen) if the
-	 * sock is non block and there aren't enough datagrams...
-	 */
-	if (err != -EAGAIN) {
+	if (datagrams != 0) {
 		/*
-		 * ... or  if recvmsg returns an error after we
-		 * received some datagrams, where we record the
-		 * error to return on the next call or if the
-		 * app asks about it using getsockopt(SO_ERROR).
+		 * We may return less entries than requested (vlen) if the
+		 * sock is non block and there aren't enough datagrams...
 		 */
-		sock->sk->sk_err = -err;
+		if (err != -EAGAIN) {
+			/*
+			 * ... or  if recvmsg returns an error after we
+			 * received some datagrams, where we record the
+			 * error to return on the next call or if the
+			 * app asks about it using getsockopt(SO_ERROR).
+			 */
+			sock->sk->sk_err = -err;
+		}
+
+		return datagrams;
 	}
-out_put:
-	fput_light(sock->file, fput_needed);
 
-	return datagrams;
+	return err;
 }
 
 SYSCALL_DEFINE5(recvmmsg, int, fd, struct mmsghdr __user *, mmsg,
